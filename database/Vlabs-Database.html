<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Vlabs-Database</title>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1"/>
<meta name="title" content="Vlabs-Database"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2014-09-02T12:33+0530"/>
<meta name="author" content="khushpreet"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">Vlabs-Database</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 <b>Introduction</b></a></li>
<li><a href="#sec-2">2 <b>Tables used in database</b></a></li>
<li><a href="#sec-3">3 <b>Code for populating database</b></a>
<ul>
<li><a href="#sec-3-1">3.1 Code for populating the data of developers_engaged table</a></li>
<li><a href="#sec-3-2">3.2 Code for populating the column institute_id_in_labs</a></li>
<li><a href="#sec-3-3">3.3 Code for populating the column disc_id in labs.</a></li>
</ul>
</li>
<li><a href="#sec-4">4 <b>Creation of dump file as a backup of the database</b></a></li>
<li><a href="#sec-5">5 <b>Extraction of database from dump file</b></a></li>
<li><a href="#sec-6">6 <b>Phpmyadmin Installation on ubuntu</b></a></li>
<li><a href="#sec-7">7 <b>Access to database</b></a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> <b>Introduction</b></h2>
<div class="outline-text-2" id="text-1">

<p>This report comprises of the information regarding database of 182 virtual labs. It contains the following information:
lab id, institutes name, developer name, discipline, repo url, lab sources availability, hosted url, lab deployed, number of experiments, content, simulation, server side dependencies, client side dependencies, web2.0 compliance, FOSS, type of lab, autohostable, status, integration levels.
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> <b>Tables used in database</b></h2>
<div class="outline-text-2" id="text-2">

<ol>
<li>labs
</li>
<li>disciplines
</li>
<li>developers
</li>
<li>developers_engaged
</li>
<li>institutes
</li>
<li>technologies
</li>
<li>technologies_used
</li>
</ol>


<p>
<img src="./database-documentation.jpg"  alt="./database-documentation.jpg" />
</p>
<p>
<b>In table labs following are the foreign keys:</b>
</p><ol>
<li>institute_id references from table institutes column id. 
</li>
<li>discipline_id references from table disciplines column id.
</li>
<li>developer references from table developers column email_id.
</li>
</ol>


<p>
<b>In table technologies_used following are the foreign keys:</b>
</p><ol>
<li>lab_id references from table labs column id. 
</li>
<li>tech_id references from table technologies column id.
</li>
</ol>


<p>
<b>In table developers_engaged following are the foreign keys:</b>
</p><ol>
<li>lab_id references from table labs column id. 
</li>
<li>developer_id references from table developers column email_id.
</li>
</ol>


</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> <b>Code for populating database</b></h2>
<div class="outline-text-2" id="text-3">

<p>All the tables were populated using MYSql Workbench except developers engaged table and two columns in labs table. They were populated using sqlalchemy.
</p>
</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Code for populating the data of developers_engaged table</h3>
<div class="outline-text-3" id="text-3-1">




<pre class="example">from flask import Flask
from flask.ext.sqlalchemy import SQLAlchemy
import csv


db = SQLAlchemy()


# each class correspons to each table

class Lab(db.Model):
    __tablename__ = 'labs'

    id = db.Column(db.Integer, primary_key=True)
    lab_id = db.Column(db.String(45))
    institute_name = db.Column(db.String(45),
                               db.ForeignKey('institutes.institute_name'))

    lab_name = db.Column(db.String(100))
    discipline_name = db.Column(db.String(100),
                                db.ForeignKey('disciplines.discipline_name'))

    developer = db.Column(db.String(100), db.ForeignKey('developers.email'))
    repo_url = db.Column(db.String(200))
    sources_available = db.Column(db.String(45))
    hosted_url = db.Column(db.String(200))
    lab_deployed = db.Column(db.String(45))
    number_of_experiments = db.Column(db.Integer)
    content = db.Column(db.String(45))
    simulation = db.Column(db.String(45))
    web_2_compliance = db.Column('web2.0_compliance', db.String(45))
    type_of_lab = db.Column(db.String(45))
    auto_hostable = db.Column(db.String(45))
    remarks = db.Column(db.String(200))
    integration_level = db.Column(db.Integer)
    status = db.Column(db.String(45))

class Institute(db.Model):
    __tablenames__ = 'institutes'

    id = db.Column(db.Integer)
    institute_name = db.Column(db.String(45), primary_key=True)
    institute_coordinators = db.Column(db.String(100))


class Discipline(db.Model):
    __tablename__ = 'disciplines'

    id = db.Column(db.Integer)
    discipline_name = db.Column(db.String(100), primary_key=True)
    dnc = db.Column(db.String(50))


class Developer(db.Model):
    __tablename__ = 'developers'

    email_id = db.Column(db.String(100), primary_key=True)
    developer_name = db.Column(db.String(100))
    institute_name = db.Column(db.String(45))


class DevelopersEngaged(db.Model):
    __tablename__ = 'developers_engaged'

    id = db.Column(db.Integer, primary_key=True)
    lab_id = db.Column(db.Integer, db.ForeignKey('labs.id'))
    developer_id = db.Column(db.String(100), db.ForeignKey('developers.email_id'))


# entry point
def run(**kwargs):
    filename = kwargs.get('csv_file')

    # open the file
    with open(filename, 'rb') as f:
        # parse it with csv module
        reader = csv.reader(f)

        # skip the first row - it contains field names
        reader.next()

        # iterate over all the rows in csv and process it
        for row in reader:
            process_row(row)


# process the passed row from csv file and extract lab_id and
# developers info from the row
def process_row(row):
    # col numbers for specific field in the csv file
    lab_id_col = 0
    developer_id_col = 4

    # if Lab_id exists..
    if row[lab_id_col]:
        # fetch the lab from the database based on its lab_id
        lab = Lab.query.filter_by(lab_id=row[lab_id_col]).first()

        # if lab does not exist in the database
        if not lab:
            print 'ERROR: ' + row[lab_id_col] + ' not in database!!!'
            print 'skipping lab ' + row[lab_id_col]
            raw_input('press any key to continue..')
            return

        # else
        print 'for lab'
        print lab.lab_id

        # get all developers engaged in that lab (and split by comma)
        developers = row[developer_id_col].split(',')

        # if there are deveopers in that lab
        if len(developers):
            for developer in developers:
                create_developer_engaged_entry(lab, developer)


# create the specific row in the `developers_engaged` table
def create_developer_engaged_entry(lab, developer):

    # remove extra leading and trailing whitespace if any
    developer = developer.strip()

    # get the developer_id from the database matching its email_id
    print developer
    developer_in_db = Developer.query.filter_by(email_id=developer).first()

    # developer doesn't exist in db!
    if not developer_in_db:
        print 'developer "' + developer + '" not in database!!'
        raw_input('press any key to continue..')
        return

    # create the new object
    dev_engaged = DevelopersEngaged(lab_id=lab.id,
                                 developer_id=developer_in_db.email_id)   

    # finally, commit it in the database
    db.session.add(dev_engaged)
    db.session.commit()


if __name__ == '__main__':

    app = Flask(__name__)
    app.config['SQLALCHEMY_DATABASE_URI'] =\
        'mysql+oursql://root:root@localhost/vlabs_info'
    db.init_app(app)
    db.app = app

    run(csv_file='list_of_versioned_labs.csv')
</pre>


</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Code for populating the column institute_id_in_labs</h3>
<div class="outline-text-3" id="text-3-2">





<pre class="example">from flask import Flask
from flask.ext.sqlalchemy import SQLAlchemy
import csv


db = SQLAlchemy()


# each class correspons to each table


class Institute(db.Model):
    __tablename__ = 'institutes'

    id = db.Column(db.Integer, primary_key=True)
    institute_name = db.Column(db.String(45))
    institute_coordinators = db.Column(db.String(100))


class Discipline(db.Model):
    __tablename__ = 'disciplines'

    id = db.Column(db.Integer)
    discipline_name = db.Column(db.String(100), primary_key=True)
    dnc = db.Column(db.String(50))


class Developer(db.Model):
    __tablename__ = 'developers'

    email_id = db.Column(db.String(100), primary_key=True)
    developer_name = db.Column(db.String(100))
    institute_name = db.Column(db.String(45))


class Lab(db.Model):
    __tablename__ = 'labs'

    id = db.Column(db.Integer, primary_key=True)
    lab_id = db.Column(db.String(45))
    institute_name = db.Column(db.String(45))

    lab_name = db.Column(db.String(100))
    discipline_name = db.Column(db.String(100),
                                db.ForeignKey('disciplines.discipline_name'))

    developer = db.Column(db.String(100), db.ForeignKey('developers.email_id'))
    repo_url = db.Column(db.String(200))
    sources_available = db.Column(db.String(45))
    hosted_url = db.Column(db.String(200))
    lab_deployed = db.Column(db.String(45))
    number_of_experiments = db.Column(db.Integer)
    content = db.Column(db.String(45))
    simulation = db.Column(db.String(45))
    web_2_compliance = db.Column('web2.0_compliance', db.String(45))
    type_of_lab = db.Column(db.String(45))
    auto_hostable = db.Column(db.String(45))
    remarks = db.Column(db.String(200))
    integration_level = db.Column(db.Integer)
    status = db.Column(db.String(45))
    institute_id = db.Column(db.Integer,
                               db.ForeignKey('institutes.id'))

# entry point
def run():
    labs = Lab.query.all()    
    for lab in labs:
        instt_name = lab.institute_name
        instt = Institute.query.filter_by(institute_name=instt_name).first()
        #print instt.id, instt.institute_name
        lab.institute_id = instt.id
        # finally, commit it in the database
        db.session.add(lab)
        db.session.commit()


if __name__ == '__main__':

    app = Flask(__name__)
    app.config['SQLALCHEMY_DATABASE_URI'] =\
        'mysql+oursql://root:root@localhost/vlabs_info'
    db.init_app(app)
    db.app = app

    run()
</pre>


</div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Code for populating the column disc_id in labs.</h3>
<div class="outline-text-3" id="text-3-3">




<pre class="example">from flask import Flask
from flask.ext.sqlalchemy import SQLAlchemy
import csv


db = SQLAlchemy()


# each class correspons to each table


class Institute(db.Model):
    __tablename__ = 'institutes'

    id = db.Column(db.Integer, primary_key=True)
    institute_name = db.Column(db.String(45))
    institute_coordinators = db.Column(db.String(100))


class Discipline(db.Model):
    __tablename__ = 'disciplines'

    id = db.Column(db.Integer)
    discipline_name = db.Column(db.String(100), primary_key=True)
    dnc = db.Column(db.String(50))


class Developer(db.Model):
    __tablename__ = 'developers'

    email_id = db.Column(db.String(100), primary_key=True)
    developer_name = db.Column(db.String(100))
    institute_name = db.Column(db.String(45))


class Lab(db.Model):
    __tablename__ = 'labs'

    id = db.Column(db.Integer, primary_key=True)
    lab_id = db.Column(db.String(45))
    lab_name = db.Column(db.String(100))
    discipline_name = db.Column(db.String(100))

    developer = db.Column(db.String(100), db.ForeignKey('developers.email_id'))
    repo_url = db.Column(db.String(200))
    sources_available = db.Column(db.String(45))
    hosted_url = db.Column(db.String(200))
    lab_deployed = db.Column(db.String(45))
    number_of_experiments = db.Column(db.Integer)
    content = db.Column(db.String(45))
    simulation = db.Column(db.String(45))
    web_2_compliance = db.Column('web2.0_compliance', db.String(45))
    type_of_lab = db.Column(db.String(45))
    auto_hostable = db.Column(db.String(45))
    remarks = db.Column(db.String(200))
    integration_level = db.Column(db.Integer)
    status = db.Column(db.String(45))
    institute_id = db.Column(db.Integer, db.ForeignKey('institutes.id'))
    discipline_id = db.Column(db.Integer, db.ForeignKey('disciplines.id'))

# entry point
def run():
    labs = Lab.query.all()    
    for lab in labs:
        disc_name = lab.discipline_name
        discipline = Discipline.query.filter_by(discipline_name=disc_name).first()
        lab.discipline_id = discipline.id
        # finally, commit it in the database
        db.session.add(lab)
        db.session.commit()


if __name__ == '__main__':

    app = Flask(__name__)
    app.config['SQLALCHEMY_DATABASE_URI'] =\
        'mysql+oursql://root:root@localhost/vlabs_info'
    db.init_app(app)
    db.app = app

    run()
</pre>


</div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> <b>Creation of dump file as a backup of the database</b></h2>
<div class="outline-text-2" id="text-4">




<pre class="example">mysqldump -u username -p dbname &gt; backupfile.sql 
</pre>

</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> <b>Extraction of database from dump file</b></h2>
<div class="outline-text-2" id="text-5">




<pre class="example">mysql -u username -p dbname &lt; backupfile.sql
</pre>

<p>
<b>Note</b> dbname must exist in your mysql.
</p></div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> <b>Phpmyadmin Installation on ubuntu</b></h2>
<div class="outline-text-2" id="text-6">


<p>
Before installing phpMyAdmin you will need access to a MySQL database either on the same host as that phpMyAdmin is installed on, or on a host accessible over the network. From a terminal prompt enter:
</p>


<pre class="example">sudo apt-get install phpmyadmin
</pre>


<p>
At the prompt choose which web server to be configured for phpMyAdmin. The rest of this section will use Apache2 for the web server.
</p>
<p>
In a browser go to <a href="http://servername/phpmyadmin">http://servername/phpmyadmin</a>, replacing serveranme with the server's actual hostname. At the login, page enter root for the username, or another MySQL user if you any setup, and enter the MySQL user's password.
</p>
<p>
Once logged in you can reset the root password if needed, create users, create/destroy databases and tables, etc.
Configuration
</p>
<p>
The configuration files for phpMyAdmin are located in /etc/phpmyadmin. The main configuration file is /etc/phpmyadmin/config.inc.php. This file contains configuration options that apply globally to phpMyAdmin.
</p>
<p>
To use phpMyAdmin to administer a MySQL database hosted on another server, adjust the following in /etc/phpmyadmin/config.inc.php:
</p>



<pre class="example">$cfg['Servers'][$i]['host'] = 'db_server';
</pre>


<p>
Replace db_server with the actual remote database server name or IP address. Also, be sure that the phpMyAdmin host has permissions to access the remote database.
</p>
<p>
Once configured, log out of phpMyAdmin and back in, and you should be accessing the new server.
</p>
<p>
The config.header.inc.php and config.footer.inc.php files are used to add a HTML header and footer to phpMyAdmin.
</p>
<p>
Another important configuration file is /etc/phpmyadmin/apache.conf, this file is symlinked to /etc/apache2/conf.d/phpmyadmin.conf, and is used to configure Apache2 to serve the phpMyAdmin site. The file contains directives for loading PHP, directory permissions, etc. For more information on configuring Apache2 see the section called "HTTPD - Apache2 Web Server".
</p>
</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> <b>Access to database</b></h2>
<div class="outline-text-2" id="text-7">

<p>Go to your browser, type ipaddress "10.4.14.225/phpmyadmin". It displays the login page of phpmyadmin.
</p>
<p>
Enter username as "guest" and Go (No Password for guest account). Then it will display the homepage.
</p>
<p>
Select vlabs_database from databases list and click on "sql" tab. 
</p>
<p>
You can type query as you want to retrieve data from database or you can run bookmarked queries from the bottom of page.
</p></div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2014-09-02T12:33+0530</p>
<p class="author">Author: khushpreet</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.3f with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
